
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id    String    @id @default(uuid())
  email   String?   @unique
  createdAt   DateTime    @default(now())

  
  chatMessages ChatMessage[]
  freeQuota    FreeQuota?
  subscriptions Subscription[]
  bundleUsage   BundleUsage[]
}

model ChatMessage {
  id        String   @id @default(uuid())
  userId    String
  question  String
  answer    String
  tokens    Int
  createdAt DateTime @default(now())

  // relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
}

model FreeQuota {
  id          String   @id @default(uuid())
  userId      String   @unique
  used        Int      @default(0)
  month       Int      // 1â€“12
  year        Int      // 2025, 2026 etc
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Subscription {
  id             String        @id @default(uuid())
  userId         String
  tier           SubscriptionTier
  billingCycle   BillingCycle
  maxMessages    Int?
  usedMessages   Int           @default(0)
  price          Float
  startDate      DateTime
  endDate        DateTime
  renewalDate    DateTime
  autoRenew      Boolean       @default(true)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())

  // relations
  user User             @relation(fields: [userId], references: [id])
  usageRecords BundleUsage[]

  @@index([userId])
  @@index([renewalDate])
}

model BundleUsage {
  id             String   @id @default(uuid())
  subscriptionId String
  userId         String
  usedAt         DateTime @default(now())
  count          Int      @default(1)

  user         User         @relation(fields: [userId], references: [id])
  subscription Subscription @relation(fields: [subscriptionId], references: [id])

  @@index([userId])
  @@index([subscriptionId])
}

enum SubscriptionTier {
  BASIC
  PRO
  ENTERPRISE
}

enum BillingCycle {
  MONTHLY
  YEARLY
}